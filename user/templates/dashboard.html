{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<div class="max-w-xl mx-auto bg-white p-6 rounded shadow">
    <h2 class="text-2xl font-bold mb-4">Make a Prediction</h2>
    <form id="predict-form">
        <label class="block mb-2 font-medium">Enter Ticker Symbol:</label>
        <input type="text" id="ticker" name="ticker" class="border px-4 py-2 w-full rounded" required>
        <button type="submit" class="bg-indigo-500 text-white px-4 py-2 mt-4 rounded hover:bg-indigo-600">
            Predict
        </button>
    </form>
    <div id="results" class="mt-6 hidden">
        <h3 class="text-xl font-semibold mb-2">Results</h3>
        <div id="metrics" class="mb-4"></div>
        <div id="plots" class="grid grid-cols-1 gap-4"></div>
    </div>
</div>

<script>
document.getElementById("predict-form").addEventListener("submit", async function (e) {
    e.preventDefault();
    const ticker = document.getElementById("ticker").value;
    const token = localStorage.getItem("access_token");

    const response = await fetch("/api/v1/predict/", {
        method: "POST",
        headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json",
        },
        body: JSON.stringify({ ticker: ticker }),
    });

    if (response.ok) {
        const data = await response.json();
        document.getElementById("results").classList.remove("hidden");
        document.getElementById("metrics").innerHTML = `
            <p><strong>Next Day Price:</strong> ${data.next_day_price}</p>
            <p>MSE: ${data.mse} | RMSE: ${data.rmse} | RÂ²: ${data.r2}</p>
        `;
        document.getElementById("plots").innerHTML = data.plot_urls.map(url =>
            `<img src="${url}" alt="Plot" class="w-full rounded shadow">`
        ).join("");
    } else {
        alert("Prediction failed. Please check token or ticker.");
    }
});
</script>
{% endblock %}
